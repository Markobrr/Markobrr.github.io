<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoGears | Košarica</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        .cart-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: var(--spacing-xl);
        }

        .cart-items {
            margin-bottom: var(--spacing-xl);
        }

        .cart-table {
            width: 100%;
            border-collapse: collapse;
        }

        .cart-table th {
            text-align: left;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--gray-300);
            font-weight: var(--font-weight-medium);
        }

        .cart-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--gray-300);
            vertical-align: middle;
        }

        .cart-product {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .cart-product-main {
            display: flex;
            align-items: center;
        }

        .cart-product-image {
            width: 80px;
            height: 80px;
            margin-right: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        .cart-product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cart-product-info h3 {
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-md);
        }





        /* Dark mode styles */
        body.dark-mode .cart-summary {
            background-color: #2d2d2d;
            color: #ffffff;
        }

        body.dark-mode .cart-table th,
        body.dark-mode .cart-table td {
            border-bottom-color: #444;
            color: #ffffff;
        }

        body.dark-mode .product-category-small {
            background: rgba(122, 158, 110, 0.2);
            color: #7a9e6e;
        }

        .cart-quantity {
            display: flex;
            align-items: center;
        }

        .cart-quantity-btn {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--gray-200);
            border: none;
            cursor: pointer;
        }

        .cart-quantity-input {
            width: 40px;
            height: 30px;
            text-align: center;
            border: 1px solid var(--gray-300);
            margin: 0 var(--spacing-xs);
        }

        .cart-remove {
            color: var(--danger-color);
            cursor: pointer;
        }

        .cart-actions {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-lg);
        }

        .cart-coupon {
            display: flex;
            max-width: 350px;
        }

        .cart-coupon input {
            flex: 1;
            padding: var(--spacing-sm);
            border: 1px solid var(--gray-300);
            border-right: none;
            border-radius: var(--border-radius-md) 0 0 var(--border-radius-md);
        }

        .cart-coupon button {
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
            cursor: pointer;
        }

        .cart-summary {
            background-color: var(--gray-100);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
        }

        .cart-summary-title {
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--gray-300);
        }

        .cart-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }

        .cart-summary-label {
            font-weight: var(--font-weight-medium);
        }

        .cart-summary-value {
            text-align: right;
        }

        .cart-summary-total {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--gray-300);
        }

        .cart-summary-buttons {
            margin-top: var(--spacing-lg);
        }

        .cart-summary-buttons .btn {
            width: 100%;
            margin-bottom: var(--spacing-sm);
        }

        /* Discount section styles */
        .discount-section {
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            background-color: var(--gray-50);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--gray-200);
        }

        .discount-section h4 {
            margin: 0 0 var(--spacing-sm) 0;
            font-size: var(--font-size-md);
            color: var(--gray-700);
        }

        .discount-input-group {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .discount-input-group input {
            flex: 1;
            padding: var(--spacing-sm);
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-sm);
        }

        .apply-discount-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: var(--font-size-sm);
            white-space: nowrap;
        }

        .apply-discount-btn:hover {
            background-color: var(--primary-dark);
        }

        .clear-discount-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--error-color);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: var(--font-size-sm);
            white-space: nowrap;
        }

        .clear-discount-btn:hover {
            background-color: #c82333;
        }

        .discount-message {
            font-size: var(--font-size-sm);
            margin-top: var(--spacing-xs);
            min-height: 20px;
        }

        .discount-message.success {
            color: var(--success-color);
        }

        .discount-message.error {
            color: var(--error-color);
        }

        .cart-summary-discount .cart-summary-value {
            color: var(--success-color);
            font-weight: var(--font-weight-medium);
        }

        /* Responsive styles for discount section */
        @media (max-width: 768px) {
            .discount-input-group {
                flex-direction: column;
                gap: var(--spacing-xs);
            }

            .apply-discount-btn,
            .clear-discount-btn {
                width: 100%;
                padding: var(--spacing-md);
                margin-bottom: var(--spacing-xs);
            }

            .discount-section {
                padding: var(--spacing-sm);
            }

            .cart-summary {
                margin-top: var(--spacing-md);
            }
        }

        @media (max-width: 480px) {
            .discount-section h4 {
                font-size: var(--font-size-sm);
            }

            .discount-input-group input {
                font-size: var(--font-size-xs);
                padding: var(--spacing-sm);
            }

            .apply-discount-btn {
                font-size: var(--font-size-xs);
                padding: var(--spacing-sm);
            }
        }

        .empty-cart {
            text-align: center;
            padding: var(--spacing-2xl) 0;
        }

        .empty-cart-icon {
            font-size: 4rem;
            color: var(--gray-400);
            margin-bottom: var(--spacing-md);
        }

        .empty-cart-message {
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-lg);
            color: var(--gray-700);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="container header-container">
            <a href="../index.html" class="logo">
                <img src="../img/logo-fin.svg" alt="ModernShop Logo" width="180" height="40">
            </a>

            <button class="mobile-menu-toggle" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>

            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html">Početna</a></li>
                    <li><a href="proizvodi.html">Proizvodi</a></li>
                    <li><a href="o-nama.html">O nama</a></li>
                    <li><a href="kontakt.html">Kontakt</a></li>
                </ul>
            </nav>

            <div class="header-actions">
                <form class="search-form">
                    <input type="search" placeholder="Pretraži...">
                    <button type="submit"><i class="fas fa-search"></i></button>
                </form>

                <button class="dark-mode-toggle header-icon" aria-label="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>

                <a href="prijava.html" class="header-icon">
                    <i class="fas fa-user"></i>
                </a>

                <a href="kosarica.html" class="header-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">3</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Breadcrumbs -->
            <div class="breadcrumbs">
                <a href="../index.html">Početna</a>
                <span class="separator"><i class="fas fa-chevron-right"></i></span>
                <span>Košarica</span>
            </div>

            <h1 class="mb-4">Moja košarica</h1>

            <!-- Cart Content -->
            <div class="cart-container">
                <div class="cart-main">
                    <div class="cart-items">
                        <table class="cart-table">
                            <thead>
                                <tr>
                                    <th>Proizvod</th>
                                    <th>Cijena</th>
                                    <th>Količina</th>
                                    <th>Ukupno</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Cart items will be dynamically generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div class="cart-actions">
                        <div class="cart-coupon">
                            <input type="text" placeholder="Kod za popust">
                            <button>Primijeni</button>
                        </div>
                        <a href="proizvodi.html" class="btn btn-outline">Nastavi s kupovinom</a>
                    </div>
                </div>

                <div class="cart-sidebar">
                    <div class="cart-summary">
                        <h2 class="cart-summary-title">Sažetak narudžbe</h2>

                        <!-- Discount Code Section -->
                        <div class="discount-section">
                            <h4>Kod za popust</h4>
                            <div class="discount-input-group">
                                <input type="text" id="discountCode" placeholder="Unesite kod za popust" maxlength="10">
                                <button class="apply-discount-btn" onclick="applyDiscount()">Primijeni</button>
                                <button class="clear-discount-btn" onclick="clearDiscount()" style="display: none;">Ukloni</button>
                            </div>
                            <div id="discountMessage" class="discount-message"></div>
                        </div>

                        <div class="cart-summary-row cart-summary-subtotal">
                            <div class="cart-summary-label">Ukupno proizvoda</div>
                            <div class="cart-summary-value">0,00 €</div>
                        </div>

                        <div class="cart-summary-row cart-summary-discount" style="display: none;">
                            <div class="cart-summary-label">Popust (20%)</div>
                            <div class="cart-summary-value discount-amount">-0,00 €</div>
                        </div>

                        <div class="cart-summary-row cart-summary-shipping">
                            <div class="cart-summary-label">Dostava</div>
                            <div class="cart-summary-value">Besplatno</div>
                        </div>

                        <div class="cart-summary-row cart-summary-total">
                            <div class="cart-summary-label">Ukupno za platiti</div>
                            <div class="cart-summary-value">0,00 €</div>
                        </div>

                        <div class="cart-summary-buttons">
                            <a href="placanje.html" class="btn btn-primary">Nastavi na plaćanje</a>
                            <a href="proizvodi.html" class="btn btn-outline">Nastavi s kupovinom</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty Cart (Hidden by default) -->
            <div class="empty-cart" style="display: none;">
                <div class="empty-cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h2 class="empty-cart-message">Vaša košarica je prazna</h2>
                <p class="mb-4">Izgleda da još niste dodali proizvode u košaricu.</p>
                <a href="proizvodi.html" class="btn btn-primary">Pregledaj proizvode</a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-container">
                <div class="footer-column">
                    <h4>O nama</h4>
                    <p>ModernShop je vodeći online trgovac s dugogodišnjim iskustvom u pružanju visokokvalitetnih proizvoda po pristupačnim cijenama.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>

                <div class="footer-column">
                    <h4>Korisni linkovi</h4>
                    <ul>
                        <li><a href="o-nama.html">O nama</a></li>
                        <li><a href="faq.html">Česta pitanja</a></li>
                        <li><a href="uvjeti-koristenja.html">Uvjeti korištenja</a></li>
                        <li><a href="politika-privatnosti.html">Politika privatnosti</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Kategorije</h4>
                    <ul>
                        <li><a href="proizvodi.html">Kategorija 1</a></li>
                        <li><a href="proizvodi.html">Kategorija 2</a></li>
                        <li><a href="proizvodi.html">Kategorija 3</a></li>
                        <li><a href="proizvodi.html">Kategorija 4</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Kontakt</h4>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> Ulica Primjer 123, 10000 Zagreb</li>
                        <li><i class="fas fa-phone"></i> +385 1 234 5678</li>
                        <li><i class="fas fa-envelope"></i> info@modernshop.hr</li>
                        <li><i class="fas fa-clock"></i> Pon - Pet: 9:00 - 17:00</li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2023 ModernShop. Sva prava pridržana.</p>
            </div>
        </div>
    </footer>

    <!-- Import product database -->
    <script src="../js/products.js"></script>

    <script>
        // Toast notification function
        function showToast(message, type = 'success') {
            // Remove existing toast if any
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;

            // Add to body
            document.body.appendChild(toast);

            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            // Hide and remove toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 3000);
        }

        // Cart functionality
        let cart = JSON.parse(sessionStorage.getItem('techshop_cart')) || [];

        function updateCartCount() {
            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
                cartCount.textContent = cart.reduce((total, item) => total + item.quantity, 0);
            }
        }

        function updateQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }

            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = parseInt(newQuantity);
                sessionStorage.setItem('techshop_cart', JSON.stringify(cart));
                renderCart();
                updateCartCount();
            }
        }

        function removeFromCart(productId) {
            const product = PRODUCT_DATABASE[productId];
            cart = cart.filter(item => item.id !== productId);
            sessionStorage.setItem('techshop_cart', JSON.stringify(cart));
            renderCart();
            updateCartCount();

            // Show removal notification
            if (product) {
                showToast(`${product.title} je uklonjen iz košarice`, 'error');
            }
        }

        function parsePrice(priceString) {
            // Remove € symbol and handle European number format (1.199,99 €)
            // First remove € and spaces, then replace comma with dot for decimal
            // and remove dots used as thousand separators
            let cleanPrice = priceString.replace(/\s*€\s*/, '').trim();

            // If there's both dot and comma, dot is thousand separator, comma is decimal
            if (cleanPrice.includes('.') && cleanPrice.includes(',')) {
                cleanPrice = cleanPrice.replace(/\./g, '').replace(',', '.');
            }
            // If only comma, it's decimal separator
            else if (cleanPrice.includes(',')) {
                cleanPrice = cleanPrice.replace(',', '.');
            }

            return parseFloat(cleanPrice) || 0;
        }

        function formatPrice(price) {
            // Format price with comma as decimal separator and € symbol
            return price.toFixed(2).replace('.', ',') + ' €';
        }

        function calculateTotal() {
            return cart.reduce((total, item) => {
                // Get actual product data from database
                const product = PRODUCT_DATABASE[item.id];
                if (product) {
                    const price = parsePrice(product.currentPrice);
                    return total + (price * item.quantity);
                }
                return total;
            }, 0);
        }

        // Discount functionality
        let discountApplied = sessionStorage.getItem('discountApplied') === 'true';
        const DISCOUNT_CODE = "1234";
        const DISCOUNT_PERCENTAGE = 0.20;

        function applyDiscount() {
            const discountCodeInput = document.getElementById('discountCode');
            const discountMessage = document.getElementById('discountMessage');
            const enteredCode = discountCodeInput.value.trim();

            if (enteredCode === DISCOUNT_CODE) {
                if (!discountApplied) {
                    discountApplied = true;
                    sessionStorage.setItem('discountApplied', 'true');
                    discountMessage.textContent = 'Kod za popust je uspješno primijenjen!';
                    discountMessage.className = 'discount-message success';
                    discountCodeInput.disabled = true;
                    document.querySelector('.apply-discount-btn').disabled = true;
                    document.querySelector('.apply-discount-btn').textContent = 'Primijenjeno';
                    document.querySelector('.clear-discount-btn').style.display = 'inline-block';

                    // Show discount row
                    document.querySelector('.cart-summary-discount').style.display = 'flex';

                    // Update cart display
                    renderCart();
                } else {
                    discountMessage.textContent = 'Kod za popust je već primijenjen.';
                    discountMessage.className = 'discount-message error';
                }
            } else {
                discountMessage.textContent = 'Neispravni kod za popust.';
                discountMessage.className = 'discount-message error';
            }

            // Clear message after 3 seconds
            setTimeout(() => {
                if (!discountApplied || discountMessage.className.includes('error')) {
                    discountMessage.textContent = '';
                    discountMessage.className = 'discount-message';
                }
            }, 3000);
        }

        function clearDiscount() {
            discountApplied = false;
            sessionStorage.removeItem('discountApplied');

            const discountCodeInput = document.getElementById('discountCode');
            const discountMessage = document.getElementById('discountMessage');

            discountCodeInput.value = '';
            discountCodeInput.disabled = false;
            document.querySelector('.apply-discount-btn').disabled = false;
            document.querySelector('.apply-discount-btn').textContent = 'Primijeni';
            document.querySelector('.clear-discount-btn').style.display = 'none';

            // Hide discount row
            document.querySelector('.cart-summary-discount').style.display = 'none';

            discountMessage.textContent = 'Popust je uklonjen';
            discountMessage.className = 'discount-message success';

            // Update cart display
            renderCart();

            // Clear message after 3 seconds
            setTimeout(() => {
                discountMessage.textContent = '';
                discountMessage.className = 'discount-message';
            }, 3000);
        }

        function renderCart() {
            const cartTableBody = document.querySelector('.cart-table tbody');
            const cartSummary = document.querySelector('.cart-summary');
            const emptyCart = document.querySelector('.empty-cart');
            const cartContainer = document.querySelector('.cart-container');



            if (cart.length === 0) {
                cartContainer.style.display = 'none';
                emptyCart.style.display = 'block';
                return;
            }

            cartContainer.style.display = 'grid';
            emptyCart.style.display = 'none';

            cartTableBody.innerHTML = cart.map(item => {
                // Get actual product data from database
                const product = PRODUCT_DATABASE[item.id];
                if (!product) return '';

                const price = parsePrice(product.currentPrice);
                const itemTotal = formatPrice(price * item.quantity);

                return `
                    <tr>
                        <td>
                            <div class="cart-product">
                                <div class="cart-product-main">
                                    <div class="cart-product-image">
                                        <img src="${product.image || 'https://picsum.photos/200/200?random=1'}" alt="${product.title}">
                                    </div>
                                    <div class="cart-product-info">
                                        <h3>${product.title}</h3>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>${product.currentPrice}</td>
                        <td>
                            <div class="cart-quantity">
                                <button class="cart-quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">-</button>
                                <input type="number" class="cart-quantity-input" value="${item.quantity}" min="1"
                                       onchange="updateQuantity('${item.id}', this.value)">
                                <button class="cart-quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">+</button>
                            </div>
                        </td>
                        <td>${itemTotal}</td>
                        <td>
                            <button class="cart-remove-btn" onclick="removeFromCart('${item.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            // Update summary
            const subtotal = calculateTotal();
            const shipping = subtotal > 50 ? 0 : 5.99;

            // Calculate discount
            let discountAmount = 0;
            if (discountApplied) {
                discountAmount = subtotal * DISCOUNT_PERCENTAGE;
            }

            const total = subtotal - discountAmount + shipping;

            document.querySelector('.cart-summary-subtotal .cart-summary-value').textContent =
                formatPrice(subtotal);

            // Update discount display
            if (discountApplied) {
                document.querySelector('.cart-summary-discount .cart-summary-value').textContent =
                    '-' + formatPrice(discountAmount);
            }

            document.querySelector('.cart-summary-shipping .cart-summary-value').textContent =
                shipping === 0 ? 'Besplatno' : formatPrice(shipping);
            document.querySelector('.cart-summary-total .cart-summary-value').textContent =
                formatPrice(total);
        }

        // Mobile menu functionality
        const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
        if (mobileMenuToggle) {
            mobileMenuToggle.addEventListener('click', function() {
                const nav = document.querySelector('.main-nav');
                nav.classList.toggle('active');

                const icon = this.querySelector('i');
                if (nav.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
        }



        // Test function to add sample products (for testing)
        function addTestProducts() {
            const testCart = [
                { id: 'iphone15pro', quantity: 1 },
                { id: 'galaxys24', quantity: 2 },
                { id: 'macbookair', quantity: 1 },
                { id: 'huaweip60', quantity: 1 }
            ];
            sessionStorage.setItem('techshop_cart', JSON.stringify(testCart));
            cart = testCart;
            renderCart();
            updateCartCount();
        }

        // Dark mode functionality
        function setupDarkMode() {
            const darkModeToggle = document.querySelector('.dark-mode-toggle');

            // Load saved preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                const icon = darkModeToggle.querySelector('i');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }

            // Add click event listener
            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');

                // Save preference
                localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));

                // Change icon
                const icon = this.querySelector('i');
                if (document.body.classList.contains('dark-mode')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
            });
        }

        // Initialize discount state on page load
        function initializeDiscountState() {
            if (discountApplied) {
                const discountCodeInput = document.getElementById('discountCode');
                const discountMessage = document.getElementById('discountMessage');

                discountCodeInput.value = DISCOUNT_CODE;
                discountCodeInput.disabled = true;
                document.querySelector('.apply-discount-btn').disabled = true;
                document.querySelector('.apply-discount-btn').textContent = 'Primijenjeno';
                document.querySelector('.clear-discount-btn').style.display = 'inline-block';
                document.querySelector('.cart-summary-discount').style.display = 'flex';

                discountMessage.textContent = 'Kod za popust je primijenjen';
                discountMessage.className = 'discount-message success';
            }
        }

        // Initialize page
        window.addEventListener('load', function() {
            // Small delay to ensure all scripts are loaded
            setTimeout(function() {
                setupDarkMode();
                updateCartCount();
                initializeDiscountState();

                // Check if PRODUCT_DATABASE is loaded
                if (typeof PRODUCT_DATABASE === 'undefined') {
                    console.error('PRODUCT_DATABASE not loaded! Adding test products...');
                    addTestProducts();
                } else {
                    console.log('PRODUCT_DATABASE loaded successfully with', Object.keys(PRODUCT_DATABASE).length, 'products');
                }

                renderCart();
            }, 100);
        });
    </script>
</body>
</html>
